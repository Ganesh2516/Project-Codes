#include <stdio.h>
#include <string.h>
#include <time.h>

#define MAX 100

struct Item {
    char name[50];
    float price;
    int quantity;
};

struct Customer {
    char name[50];
    char phone_number[15];
    char address[100];
    int credit_points;
};

struct Stack {
    struct Item items[MAX];
    int top;
};

void initialize(struct Stack *s) {
    s->top = -1;
}

int isFull(struct Stack *s) {
    return s->top == MAX - 1;
}

int isEmpty(struct Stack *s) {
    return s->top == -1;
}

void push(struct Stack *s, struct Item item) {
    if (isFull(s)) {
        printf("Cart is full!\n");
        return;
    }
    s->items[++s->top] = item;
    printf("Item added to cart.\n");
}

void pop(struct Stack *s) {
    if (isEmpty(s)) {
        printf("Cart is empty!\n");
        return;
    }
    printf("Removed item: %s\n", s->items[s->top].name);
    s->top--;
}

void displayCart(struct Stack *s) {
    if (isEmpty(s)) {
        printf("Cart is empty!\n");
        return;
    }
    float total = 0;
    printf("\nYour Cart:\n");
    printf("Name\t\tPrice\tQty\tAmount\n");
    for (int i = 0; i <= s->top; i++) {
        float amt = s->items[i].price * s->items[i].quantity;
        total += amt;
        printf("%s\t\t%.2f\t%d\t%.2f\n", s->items[i].name, s->items[i].price, s->items[i].quantity, amt);
    }
    printf("Total Amount: %.2f\n", total);
}

void searchItem(struct Stack *s, const char *itemName) {
    if (isEmpty(s)) {
        printf("Cart is empty!\n");
        return;
    }

    int found = 0;
    for (int i = 0; i <= s->top; i++) {
        if (strcasecmp(s->items[i].name, itemName) == 0) {
            printf("\nItem found in cart:\n");
            printf("Name: %s\n", s->items[i].name);
            printf("Price: %.2f\n", s->items[i].price);
            printf("Quantity: %d\n", s->items[i].quantity);
            found = 1;
            break;
        }
    }

    if (!found) {
        printf("Item \"%s\" not found in cart.\n", itemName);
    }
}

// Wishlist functionality
void addToWishlist(struct Stack *wishlist, struct Item item) {
    if (isFull(wishlist)) {
        printf("Wishlist is full!\n");
        return;
    }
    wishlist->items[++wishlist->top] = item;
    printf("Item added to wishlist.\n");
}

void viewWishlist(struct Stack *wishlist) {
    if (isEmpty(wishlist)) {
        printf("Wishlist is empty!\n");
        return;
    }

    printf("\nWishlist:\n");
    for (int i = 0; i <= wishlist->top; i++) {
        printf("%s\t%.2f\n", wishlist->items[i].name, wishlist->items[i].price);
    }
}
void displayDiscounts() {
    struct Item items[] = {
        {"Apple", 50.0}, {"Banana", 20.0}, {"Orange", 30.0}, {"Grapes", 20.0}, {"Cherry", 50.0},
        {"Kiwi", 60.0}, {"Mango", 90.0}, {"Papaya", 40.0}, {"Pear", 90.0}, {"Guava", 30.0},
        {"Carrot", 20.0}, {"Beans", 10.0}, {"Tomato", 55.0}, {"Onion", 50.0}, {"Peas", 5.0},
        {"Brinjal", 15.0}, {"Chilli", 30.0}, {"Garlic", 40.0}, {"Corn", 50.0}, {"Potato", 45.0},
        {"Butter", 50.0}, {"Cheese", 80.0}, {"Eggs", 5.0}, {"Milk", 25.0}, {"Cream", 45.0},
        {"Yogurt", 50.0}, {"Water", 10.0}, {"Bread", 35.0}, {"Bun", 10.0}, {"Cereal", 65.0},
        {"Rice", 100.0}, {"Pasta", 50.0}, {"Wheat", 75.0}, {"Oatmeal", 65.0}, {"Tea", 250.0},
        {"Coffee", 300.0}, {"Dal", 75.0}, {"Sugar", 150.0}, {"Salt", 120.0}, {"Candy", 10.0},
        {"Chocos", 120.0}, {"Chips", 45.0}, {"Cookies", 60.0}, {"Nuts", 170.0}, {"Brush", 15.0},
        {"Paste", 45.0}, {"Shampoo", 250.0}, {"Serum", 320.0}, {"Soap", 50.0}, {"Perfume", 120.0}
    };

    printf("\nItem\t\tPrice\tDiscount Price\n");
    for (int i = 0; i < 50; i++) {
        float discountPrice = items[i].price * 0.9;
        printf("%s\t\t%.2f\t%.2f\n", items[i].name, items[i].price, discountPrice);
    }
    printf("----------------------------------\n");
}

void generateBillFromCart(struct Stack *s) {
    float total = 0, discount = 0, gst;
    float delivery_charge = 0;

    if (isEmpty(s)) {
        printf("Your cart is empty. Cannot generate bill.\n");
        return;
    }

    char name[50], address[100], email[50], phone[15];
    time_t t = time(NULL);
    struct tm *time_ptr = localtime(&t);

    printf("\nEnter your name: ");
    scanf(" %[^\n]", name);
    printf("Enter your address: ");
    scanf(" %[^\n]", address);
    printf("Enter your phone number: ");
    scanf("%s", phone);
    while (strlen(phone) != 10) {
        printf("Please enter a 10-digit phone number: ");
        scanf("%s", phone);
    }
    printf("Enter your email: ");
    scanf(" %[^\n]", email);

    float km;
    printf("Enter delivery distance (in km): ");
    scanf("%f", &km);
    delivery_charge = km * 100;

    printf("\n----- GRAND TOTAL -----\n");
    printf("E-COMMERCE SHOPPING\nCUSTOMER CARE: 044-7167160\n");
    printf("Date: %02d-%02d-%d  Time: %02d:%02d:%02d\n",
           time_ptr->tm_mday, time_ptr->tm_mon + 1, time_ptr->tm_year + 1900,
           time_ptr->tm_hour, time_ptr->tm_min, time_ptr->tm_sec);

    printf("\nCustomer: %s\nAddress: %s\nPhone: %s\nEmail: %s\n", name, address, phone, email);
    printf("\nItem\tPrice\tQty\tAmount\n");

    for (int i = 0; i <= s->top; i++) {
        float amt = s->items[i].price * s->items[i].quantity;
        printf("%s\t%.2f\t%d\t%.2f\n", s->items[i].name, s->items[i].price, s->items[i].quantity, amt);
        total += amt;
        if (amt > 1000) discount += amt * 0.1;
    }

    total += 10;
    printf("Carry bag charge: 10.00 (Mandatory)\n");

    total += delivery_charge;
    printf("Delivery charge: %.2f\n", delivery_charge);

    gst = total * 0.18;
    float final_amount = total - discount + gst;

    printf("\n---------------------------\n");
    printf("Subtotal: %.2f\n", total);
    printf("Discount: %.2f\n", discount);
    printf("GST (18%%): %.2f\n", gst);
    printf("Total Amount Payable: %.2f\n", final_amount);
    printf("---------------------------\n");

    printf("Select Payment Mode:\n1. UPI\n2. Cash on Delivery\nEnter choice: ");
    int payment_choice;
    scanf("%d", &payment_choice);

    if (payment_choice == 1) {
        char upi_id[50], upi_pin[10];
        printf("Enter your UPI ID: ");
        scanf(" %[^\n]", upi_id);

        do {
            printf("Enter UPI PIN (6 digits): ");
            scanf(" %[^\n]", upi_pin);
            if (strlen(upi_pin) != 6) {
                printf("Invalid PIN! Please enter a 6-digit PIN.\n");
            }
        } while (strlen(upi_pin) != 6);

        printf("Paying %.2f from %s...\n", final_amount, upi_id);
        printf("Payment successful!\n");
    } else if (payment_choice == 2) {
        printf("Please keep Rs. %.2f ready for Cash on Delivery.\n", final_amount);
    } else {
        printf("Invalid payment option selected.\n");
    }

    printf("NO RETURN POLICY \n");
    printf("THANK YOU FOR SHOPPING WITH US!\n");
}

void displayCustomerDetails() {
    struct Customer customers[] = {
        {"Johan", "1234567890", "12 Main St, Chennai", 1000},
        {"Ajith", "9876543210", "45 Park Ave, Chennai", 2000},
        {"Vijay", "8346528709", "23 Mugappair, Chennai", 3000},
        {"Riya", "6248442846", "53 Anna Nagar, Chennai", 4500},
        {"Dia", "8428053567", "12 Chrompet, Chennai", 2500},
        {"Berti", "9360111840", "16 Vadapalani, Chennai", 6000},
        {"Daphy", "8905672921", "2 Maduravoyal, Chennai", 5500},
        {"Fany", "7937469274", "5 Ayapakkam, Chennai", 7000},
        {"Rizz", "6373652886", "9 Ambattur, Chennai", 8500},
        {"Mo", "6463735354", "1 Koyambedu, Chennai", 9000}
    };

    printf("\nRegular Customer Details:\n");
    printf("Name\tPhone Number\tAddress\t\t\tCredit Points\n");
    for (int i = 0; i < 10; i++) {
        printf("%s\t%s\t%s\t%d\n", customers[i].name, customers[i].phone_number, customers[i].address, customers[i].credit_points);
    }
    printf("------------------------------------------------------------\n");
}

// ... [Rest of your code remains unchanged, including the generateBillFromCart function]

int main() {
    struct Stack cart, wishlist;
    initialize(&cart);
    initialize(&wishlist);
    int choice;

    do {
        printf("\n--- E-commerce Shopping Cart ---\n");
        printf("1. Display discounts\n");
        printf("2. Add item(s) to cart\n");
        printf("3. View cart\n");
        printf("4. Remove last item\n");
        printf("5. View cart\n");
        printf("6. Generate bill\n");
        printf("7. Display customer details\n");
        printf("8. Add item to wishlist\n");
        printf("9.View wishlist\n");
        printf("10.Search item in cart\n");
        printf("11.Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

        struct Item item;
        switch (choice) {
            case 1:
                displayDiscounts();
                break;
            case 2: {
                int n;
                printf("How many items do you want to add? ");
                scanf("%d", &n);
                for (int i = 0; i < n; i++) {
                    printf("\nEnter details for item %d:\n", i + 1);
                    printf("Enter item name: ");
                    scanf(" %[^\n]", item.name);
                    printf("Enter item price: ");
                    scanf("%f", &item.price);
                    printf("Enter quantity: ");
                    scanf("%d", &item.quantity);
                    push(&cart, item);
                }
                break;
            }
            case 3:
                displayCart(&cart);
                break;
            case 4:
                pop(&cart);
                break;
            case 5:
                displayCart(&cart);
                break;
            case 6:
                generateBillFromCart(&cart);
                break;
            case 7:
                displayCustomerDetails();
                break;
            case 8:
               {
              int n;
              printf("How many items do you want to add to the wishlist? ");
             scanf("%d", &n);
             for (int i = 0; i < n; i++) {
             printf("\nEnter details for wishlist item %d:\n", i + 1);
             printf("Enter item name: ");
             scanf(" %[^\n]", item.name);
             printf("Enter item price: ");
             scanf("%f", &item.price);
             printf("Enter quantity: ");
             scanf("%d", &item.quantity);
             addToWishlist(&wishlist, item);
             }
              break;
             }
            case 9:
                viewWishlist(&wishlist);
                break;
            case 10:
                 {
                char searchName[50];
                printf("Enter item name to search: ");
                scanf(" %[^\n]", searchName);
                searchItem(&cart, searchName);
                break;
            }
            case 11:
			 printf("Exiting... Thank you!\n");
                break;
            default:
                printf("Invalid choice. Please try again.\n");
        }
    } while (choice != 11);

    return 0;
}